<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>é¡¹ç›®è‡ªåŠ¨åŒ–éƒ¨ç½² | AlexTao çš„ åšå®¢</title>
    <meta name="description" content="In doing we learn.">
    <link rel="icon" href="favicon.ico">
    
    <link rel="preload" href="/Weblog/assets/css/styles.bc17a3fe.css" as="style"><link rel="preload" href="/Weblog/assets/js/app.bc17a3fe.js" as="script"><link rel="preload" href="/Weblog/assets/js/47.a44c77ff.js" as="script"><link rel="prefetch" href="/Weblog/assets/css/16.styles.2339a627.css"><link rel="prefetch" href="/Weblog/assets/css/5.styles.c1152841.css"><link rel="prefetch" href="/Weblog/assets/css/7.styles.1f4a6057.css"><link rel="prefetch" href="/Weblog/assets/css/8.styles.5b6e1357.css"><link rel="prefetch" href="/Weblog/assets/js/0.a8dcd889.js"><link rel="prefetch" href="/Weblog/assets/js/10.bbae2931.js"><link rel="prefetch" href="/Weblog/assets/js/100.b8573d34.js"><link rel="prefetch" href="/Weblog/assets/js/101.abec8cfc.js"><link rel="prefetch" href="/Weblog/assets/js/102.79aa7798.js"><link rel="prefetch" href="/Weblog/assets/js/11.249c3d32.js"><link rel="prefetch" href="/Weblog/assets/js/12.6c4f9a9d.js"><link rel="prefetch" href="/Weblog/assets/js/13.9c3a7225.js"><link rel="prefetch" href="/Weblog/assets/js/14.8788763f.js"><link rel="prefetch" href="/Weblog/assets/js/15.c3d91b4b.js"><link rel="prefetch" href="/Weblog/assets/js/16.2339a627.js"><link rel="prefetch" href="/Weblog/assets/js/17.f68b5694.js"><link rel="prefetch" href="/Weblog/assets/js/18.1dc877c8.js"><link rel="prefetch" href="/Weblog/assets/js/19.8d3a8eb9.js"><link rel="prefetch" href="/Weblog/assets/js/2.adb0855b.js"><link rel="prefetch" href="/Weblog/assets/js/20.5b430c8f.js"><link rel="prefetch" href="/Weblog/assets/js/21.7570ba60.js"><link rel="prefetch" href="/Weblog/assets/js/22.c34e9396.js"><link rel="prefetch" href="/Weblog/assets/js/23.d89c70ce.js"><link rel="prefetch" href="/Weblog/assets/js/24.cc87bb5d.js"><link rel="prefetch" href="/Weblog/assets/js/25.024b7a56.js"><link rel="prefetch" href="/Weblog/assets/js/26.0d0e2118.js"><link rel="prefetch" href="/Weblog/assets/js/27.fd65c2c2.js"><link rel="prefetch" href="/Weblog/assets/js/28.e7e81b37.js"><link rel="prefetch" href="/Weblog/assets/js/29.d69a29c6.js"><link rel="prefetch" href="/Weblog/assets/js/3.9c9ae281.js"><link rel="prefetch" href="/Weblog/assets/js/30.e02a9f2a.js"><link rel="prefetch" href="/Weblog/assets/js/31.4d5d63f6.js"><link rel="prefetch" href="/Weblog/assets/js/32.2652c4b5.js"><link rel="prefetch" href="/Weblog/assets/js/33.f81118fb.js"><link rel="prefetch" href="/Weblog/assets/js/34.6539d2a9.js"><link rel="prefetch" href="/Weblog/assets/js/35.479b4b73.js"><link rel="prefetch" href="/Weblog/assets/js/36.24e9784f.js"><link rel="prefetch" href="/Weblog/assets/js/37.13a7e720.js"><link rel="prefetch" href="/Weblog/assets/js/38.57e7625b.js"><link rel="prefetch" href="/Weblog/assets/js/39.40ddc61b.js"><link rel="prefetch" href="/Weblog/assets/js/4.cb1adf5e.js"><link rel="prefetch" href="/Weblog/assets/js/40.4abade23.js"><link rel="prefetch" href="/Weblog/assets/js/41.03a22716.js"><link rel="prefetch" href="/Weblog/assets/js/42.4bf6acac.js"><link rel="prefetch" href="/Weblog/assets/js/43.7d75114c.js"><link rel="prefetch" href="/Weblog/assets/js/44.a74a0979.js"><link rel="prefetch" href="/Weblog/assets/js/45.224f0ae1.js"><link rel="prefetch" href="/Weblog/assets/js/46.716c0ee0.js"><link rel="prefetch" href="/Weblog/assets/js/48.c92bc6c3.js"><link rel="prefetch" href="/Weblog/assets/js/49.78d85a96.js"><link rel="prefetch" href="/Weblog/assets/js/5.c1152841.js"><link rel="prefetch" href="/Weblog/assets/js/50.65d4cc82.js"><link rel="prefetch" href="/Weblog/assets/js/51.dfe21a00.js"><link rel="prefetch" href="/Weblog/assets/js/52.a55d1d66.js"><link rel="prefetch" href="/Weblog/assets/js/53.24e5ba30.js"><link rel="prefetch" href="/Weblog/assets/js/54.3d44c9e1.js"><link rel="prefetch" href="/Weblog/assets/js/55.5509d3c1.js"><link rel="prefetch" href="/Weblog/assets/js/56.389f0044.js"><link rel="prefetch" href="/Weblog/assets/js/57.a6410cdf.js"><link rel="prefetch" href="/Weblog/assets/js/58.99de433a.js"><link rel="prefetch" href="/Weblog/assets/js/59.f362327e.js"><link rel="prefetch" href="/Weblog/assets/js/6.829d0e7e.js"><link rel="prefetch" href="/Weblog/assets/js/60.d8a731fd.js"><link rel="prefetch" href="/Weblog/assets/js/61.c32405a4.js"><link rel="prefetch" href="/Weblog/assets/js/62.2cf15697.js"><link rel="prefetch" href="/Weblog/assets/js/63.97976992.js"><link rel="prefetch" href="/Weblog/assets/js/64.df2f0acc.js"><link rel="prefetch" href="/Weblog/assets/js/65.0365fc24.js"><link rel="prefetch" href="/Weblog/assets/js/66.89f67105.js"><link rel="prefetch" href="/Weblog/assets/js/67.4d546178.js"><link rel="prefetch" href="/Weblog/assets/js/68.b3742591.js"><link rel="prefetch" href="/Weblog/assets/js/69.e2c032ec.js"><link rel="prefetch" href="/Weblog/assets/js/7.1f4a6057.js"><link rel="prefetch" href="/Weblog/assets/js/70.f262dfb0.js"><link rel="prefetch" href="/Weblog/assets/js/71.24d5a255.js"><link rel="prefetch" href="/Weblog/assets/js/72.c2fad7bd.js"><link rel="prefetch" href="/Weblog/assets/js/73.e3de86c7.js"><link rel="prefetch" href="/Weblog/assets/js/74.af039d36.js"><link rel="prefetch" href="/Weblog/assets/js/75.b5d26a4d.js"><link rel="prefetch" href="/Weblog/assets/js/76.5253b8d4.js"><link rel="prefetch" href="/Weblog/assets/js/77.13049fae.js"><link rel="prefetch" href="/Weblog/assets/js/78.732e7950.js"><link rel="prefetch" href="/Weblog/assets/js/79.91a95405.js"><link rel="prefetch" href="/Weblog/assets/js/8.5b6e1357.js"><link rel="prefetch" href="/Weblog/assets/js/80.60b08cac.js"><link rel="prefetch" href="/Weblog/assets/js/81.09852d19.js"><link rel="prefetch" href="/Weblog/assets/js/82.49b521d3.js"><link rel="prefetch" href="/Weblog/assets/js/83.681a706a.js"><link rel="prefetch" href="/Weblog/assets/js/84.ca93e702.js"><link rel="prefetch" href="/Weblog/assets/js/85.9813d878.js"><link rel="prefetch" href="/Weblog/assets/js/86.632f014f.js"><link rel="prefetch" href="/Weblog/assets/js/87.7737cd73.js"><link rel="prefetch" href="/Weblog/assets/js/88.1ec9c00d.js"><link rel="prefetch" href="/Weblog/assets/js/89.bbeb975f.js"><link rel="prefetch" href="/Weblog/assets/js/9.c685ce8f.js"><link rel="prefetch" href="/Weblog/assets/js/90.eda536dd.js"><link rel="prefetch" href="/Weblog/assets/js/91.391681fc.js"><link rel="prefetch" href="/Weblog/assets/js/92.dca04870.js"><link rel="prefetch" href="/Weblog/assets/js/93.01d44a2a.js"><link rel="prefetch" href="/Weblog/assets/js/94.f941a99a.js"><link rel="prefetch" href="/Weblog/assets/js/95.232bf755.js"><link rel="prefetch" href="/Weblog/assets/js/96.d381c6e0.js"><link rel="prefetch" href="/Weblog/assets/js/97.2a0ba8ba.js"><link rel="prefetch" href="/Weblog/assets/js/98.001e708c.js"><link rel="prefetch" href="/Weblog/assets/js/99.0ff7167d.js">
    <link rel="stylesheet" href="/Weblog/assets/css/styles.bc17a3fe.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/Weblog/" class="home-link router-link-active"><!----><span class="site-name">
      AlexTao çš„ åšå®¢
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/Weblog/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Classify</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/Weblog/html_css/" class="nav-link">HTML/CSS</a></li><li class="dropdown-item"><!----><a href="/Weblog/javascript/" class="nav-link">Javascript</a></li><li class="dropdown-item"><!----><a href="/Weblog/node/" class="nav-link">Node.js</a></li><li class="dropdown-item"><!----><a href="/Weblog/frames/" class="nav-link">Frames</a></li><li class="dropdown-item"><!----><a href="/Weblog/tool/" class="nav-link">Tool</a></li><li class="dropdown-item"><!----><a href="/Weblog/currency/" class="nav-link router-link-active">Currency</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/AlexTaoClub" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Weblog/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Classify</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/Weblog/html_css/" class="nav-link">HTML/CSS</a></li><li class="dropdown-item"><!----><a href="/Weblog/javascript/" class="nav-link">Javascript</a></li><li class="dropdown-item"><!----><a href="/Weblog/node/" class="nav-link">Node.js</a></li><li class="dropdown-item"><!----><a href="/Weblog/frames/" class="nav-link">Frames</a></li><li class="dropdown-item"><!----><a href="/Weblog/tool/" class="nav-link">Tool</a></li><li class="dropdown-item"><!----><a href="/Weblog/currency/" class="nav-link router-link-active">Currency</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/AlexTaoClub" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><!----></nav><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading open"><span>currency</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/Weblog/currency/" aria-current="page" class="sidebar-link">è®¡ç®—æœº</a></li><li><a href="/Weblog/currency/å‰ç«¯å¼€å‘è§„èŒƒ.html" class="sidebar-link">ç¼–ç è§„èŒƒ</a></li><li><a href="/Weblog/currency/DevOps.html" class="sidebar-link">DevOps</a></li><li><a href="/Weblog/currency/é¡¹ç›®è‡ªåŠ¨åŒ–éƒ¨ç½².html" class="active sidebar-link">é¡¹ç›®è‡ªåŠ¨åŒ–éƒ¨ç½²</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Weblog/currency/é¡¹ç›®è‡ªåŠ¨åŒ–éƒ¨ç½².html#ssh-copy-id" class="sidebar-link">ssh-copy-id</a></li><li class="sidebar-sub-header"><a href="/Weblog/currency/é¡¹ç›®è‡ªåŠ¨åŒ–éƒ¨ç½².html#nginx-å®‰è£…" class="sidebar-link">nginx å®‰è£…</a></li><li class="sidebar-sub-header"><a href="/Weblog/currency/é¡¹ç›®è‡ªåŠ¨åŒ–éƒ¨ç½².html#nvmå®‰è£…" class="sidebar-link">nvmå®‰è£…</a></li><li class="sidebar-sub-header"><a href="/Weblog/currency/é¡¹ç›®è‡ªåŠ¨åŒ–éƒ¨ç½².html#pm2" class="sidebar-link">PM2</a></li><li class="sidebar-sub-header"><a href="/Weblog/currency/é¡¹ç›®è‡ªåŠ¨åŒ–éƒ¨ç½².html#ç§æœ‰åŒ–gitlabéƒ¨ç½²" class="sidebar-link">ç§æœ‰åŒ–gitlabéƒ¨ç½²</a></li><li class="sidebar-sub-header"><a href="/Weblog/currency/é¡¹ç›®è‡ªåŠ¨åŒ–éƒ¨ç½².html#jenkins" class="sidebar-link">Jenkins</a></li><li class="sidebar-sub-header"><a href="/Weblog/currency/é¡¹ç›®è‡ªåŠ¨åŒ–éƒ¨ç½².html#gitlab-jenkins-è‡ªåŠ¨åŒ–éƒ¨ç½²" class="sidebar-link">gitlab + jenkins è‡ªåŠ¨åŒ–éƒ¨ç½²</a></li></ul></li><li><a href="/Weblog/currency/å‰ç«¯å®‰å…¨.html" class="sidebar-link">å‰ç«¯å®‰å…¨</a></li><li><a href="/Weblog/currency/å‰ç«¯ç®—æ³•.html" class="sidebar-link">å‰ç«¯ç®—æ³•</a></li><li><a href="/Weblog/currency/å‡½æ•°å®ç°.html" class="sidebar-link">å‡½æ•°å®ç°</a></li><li><a href="/Weblog/currency/é€šç”¨å‡½æ•°.html" class="sidebar-link">é€šç”¨å‡½æ•°</a></li><li><a href="/Weblog/currency/ä¾‹é¢˜æ€»ç»“.html" class="sidebar-link">ä¾‹é¢˜åˆ†æ </a></li></ul></div></li></ul></div><div class="page"><div class="content"><h3 id="é¡¹ç›®è‡ªåŠ¨åŒ–éƒ¨ç½²">é¡¹ç›®è‡ªåŠ¨åŒ–éƒ¨ç½²</h3><h2 id="ssh-copy-id">ssh-copy-id</h2><p>ä½¿ç”¨sshå»ç™»é™†åˆ°è¿œç¨‹æœåŠ¡å™¨çš„è„šæœ¬</p><div class="language- extra-class"><pre class="language-text"><code>ssh-copy-id -i .ssh/id_rsa.pub  root@47.94.86.110
ssh root@47.94.86.110
</code></pre></div><h2 id="nginx-å®‰è£…">nginx å®‰è£…</h2><p>å®‰è£…æœåŠ¡å™¨éœ€è¦ç”¨åˆ°çš„æ¨¡å—</p><div class="language- extra-class"><pre class="language-text"><code>yum install -y gcc gcc-c++ pcre pcre-devel zlib zlib-devel openssl openssl-devel
</code></pre></div><p>æå‰åˆ›å»ºå¥½è½¯ä»¶éœ€è¦ä½¿ç”¨åˆ°çš„ç›®å½•</p><div class="language- extra-class"><pre class="language-text"><code>mkdir -p /usr/local/nginx
mkdir -p /var/log/nginx
mkdir -p /var/temp/nginx
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>--prefix=/usr/local/nginx æŒ‡å®šæœåŠ¡å®‰è£…åˆ°ä»€ä¹ˆç›®å½•
--error-log-path=/var/log/nginx/error.log  æŒ‡å®šé”™è¯¯æ—¥å¿—å­˜æ”¾åœ°å€ 
/var/temp/nginx å­˜æ”¾ä»£ç†è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸´æ—¶æ–‡ä»¶
</code></pre></div><p>1.ä¸‹è½½ openssl (åˆ°å®˜ç½‘æŸ¥çœ‹æœ€æ–°çš„ç‰ˆæœ¬ï¼Œå¯ä»¥ä¸‹è½½æœ€æ–°çš„)
wget -c http://www.openssl.org/source/openssl-1.0.1c.tar.gz
å°† openssl è§£å‹ï¼ˆè®°ä½è§£å‹åçš„ç›®å½•ï¼‰
2.åˆ° nginx å®˜ç½‘ä¸‹è½½æœ€æ–°çš„ nginx æºç ï¼Œ è§£å‹ è¿›å…¥è§£å‹åçš„ç›®å½•æ‰§è¡Œä¸‹é¢çš„ä»£ç ï¼Œè¯¥å‘½ä»¤æ˜¯é…ç½®å¦‚ä½•ç¼–è¯‘ nginx</p><p>wget -c http://nginx.org/download/nginx-1.14.2.tar.gz</p><div class="language- extra-class"><pre class="language-text"><code>tar -tzvf xxx.tar.gz
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>./configure --prefix=/usr/local/nginx \   
--pid-path=/var/local/nginx/nginx.pid \
--lock-path=/var/lock/nginx/nginx.lock \
--error-log-path=/var/log/nginx/error.log \
--http-log-path=/var/log/nginx/access.log \
--with-openssl=/root/nginx/openssl-1.0.1c \  # è¿™é‡Œä½¿ç”¨ openssl è§£å‹åçš„ç›®å½•ï¼Œéœ€è¦ä¿®æ”¹ï¼ï¼ï¼
--with-http_gzip_static_module \
--with-http_ssl_module \
--with-threads \
--with-debug \
--with-http_v2_module \
--with-stream \
--http-client-body-temp-path=/var/temp/nginx/client \
--http-proxy-temp-path=/var/temp/nginx/proxy \
--http-fastcgi-temp-path=/var/temp/nginx/fastcgi \
--http-uwsgi-temp-path=/var/temp/nginx/uwsgi \
--http-scgi-temp-path=/var/temp/nginx/scgi
ç¼–è¯‘
make
å°†ç¼–è¯‘åçš„ç»“æœè¿›è¡Œå®‰è£…
make install
</code></pre></div><h4 id="nginx-bash">nginx - bash</h4><div class="language- extra-class"><pre class="language-text"><code>#!/bin/bash
echo &quot;----------nginx config start----------&quot;
mkdir -p /usr/local/nginx
mkdir -p /var/log/nginx
mkdir -p /var/temp/nginx
cd ./nginx-1.14.2
./configure --prefix=/usr/local/nginx --pid-path=/var/local/nginx/nginx.pid --lock-path=/var/lock/nginx/nginx.lock --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --with-openssl=/openssl-1.1.0g --with-http_gzip_static_module --with-http_ssl_module --with-threads --with-debug --with-http_v2_module --with-stream --http-client-body-temp-path=/var/temp/nginx/client --http-proxy-temp-path=/var/temp/nginx/proxy --http-fastcgi-temp-path=/var/temp/nginx/fastcgi --http-uwsgi-temp-path=/var/temp/nginx/uwsgi --http-scgi-temp-path=/var/temp/nginx/scgi
make
make install
echo &quot;----------nginx config end----------&quot;
</code></pre></div><h4 id="nginx-æœªæ‰¾åˆ°å‘½ä»¤">Nginx-æœªæ‰¾åˆ°å‘½ä»¤</h4><div class="language- extra-class"><pre class="language-text"><code>vim /etc/profile

åœ¨profileæ–‡ä»¶æœ«å°¾ï¼ŒåŠ ä¸Šä¸€è¡Œ
æŒ‡å‘ä½ çš„nginxçš„å®‰è£…ä½ç½®çš„sbin ç›®å½•
PATH=$PATH:/usr/local/nginx/sbin

é‡æ–°åŠ è½½ç¯å¢ƒ
source /etc/profile   ===&gt;&gt;&gt; 

nginx -v : nginx version: nginx/1.14.2
</code></pre></div><h2 id="nvmå®‰è£…">nvmå®‰è£…</h2><p>å…ˆå¸è½½,åœ¨å®‰è£…</p><div class="language- extra-class"><pre class="language-text"><code>curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.2/install.sh | bash
</code></pre></div><p>é€šè¿‡cd ~/.nvmæŸ¥çœ‹é‡Œé¢çš„æ‰€æœ‰æ–‡ä»¶ï¼Œå¦‚æœæœ‰nvm.shå°±æˆåŠŸäº†</p><p>æœ¬åœ°è¿è¡Œnvmè¿˜æ˜¯å‡ºç°command not foundï¼Œé‚£ä¹ˆè¯·æ£€æŸ¥æ˜¯å¦å«æœ‰.bash_profileæ–‡ä»¶</p><div class="language- extra-class"><pre class="language-text"><code>ls -a | grep .bash_profile
</code></pre></div><p>æ²¡æœ‰bash_profileåˆ™æ–°å»ºæ–‡ä»¶ï¼Œæ­£å¸¸.bash_profileå†…å®¹</p><div class="language- extra-class"><pre class="language-text"><code>export NVM_DIR=&quot;$HOME/.nvm&quot;
[ -s &quot;$NVM_DIR/nvm.sh&quot; ] &amp;&amp; \. &quot;$NVM_DIR/nvm.sh&quot;  # This loads nvm
[ -s &quot;$NVM_DIR/bash_completion&quot; ] &amp;&amp; \. &quot;$NVM_DIR/bash_completion&quot;  # This loads nvm bash_completion

source ~/.bashrc
</code></pre></div><p><strong>åˆ‡æ¢nodeé»˜è®¤ç‰ˆæœ¬</strong></p><div class="language- extra-class"><pre class="language-text"><code>nvm ls-remote
nvm install stable(æœ€æ–°ç¨³å®šæ£’)
nvm alias default ç‰ˆæœ¬å·
</code></pre></div><h2 id="pm2">PM2</h2><div class="language- extra-class"><pre class="language-text"><code>npm install pm2 -g
</code></pre></div><h2 id="ç§æœ‰åŒ–gitlabéƒ¨ç½²">ç§æœ‰åŒ–gitlabéƒ¨ç½²</h2><p>http://www.git-scm.com.cn/1466.html</p><p>https://www.cnblogs.com/sunmmi/articles/5847785.html
https://blog.51cto.com/caiyuanji/2114796?cid=707746</p><h4 id="gitlabæœåŠ¡">gitlabæœåŠ¡</h4><div class="language- extra-class"><pre class="language-text"><code>yum install -y curl openssh-server openssh-clients postfix cronie policycoreutils-python
//10.xä»¥åå¼€å§‹ä¾èµ–policycoreutils-python
systemctl start postfix
systemctl enable postfix
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>wget -c https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/gitlab-ce-12.1.12-ce.0.el7.x86_64.rpm
rpm -ivh gitlab-ce-12.1.12-ce.0.el7.x86_64.rpm     
gitlab-ctl reconfigure
gitlab-ctl stop
gitlab-ctl start
gitlab-ctl restart
</code></pre></div><h4 id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</h4><p><strong>é…ç½®ä¿®æ”¹éœ€è¦é‡æ–°ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œå¹¶ä¸”é‡å¯</strong></p><ul><li>gitlabè‡ªå¸¦çš„nginx å’Œ æœåŠ¡å™¨å·²æœ‰çš„nginxå†²çª</li></ul><div class="language- extra-class"><pre class="language-text"><code>vim /etc/gitlab/gitlab.rb
nginx['listen_port'] = 8899 (line 1046)
external_url 'åŸŸå:8899'
unicorn['port'] = 8877(å¯ä»¥ä¸ä¿®æ”¹  line 695)  

vim /var/opt/gitlab/gitlab-rails/etc/unicorn.rb(å¯ä»¥ä¸ä¿®æ”¹)
listen &quot;127.0.0.1:8877&quot;, :tcp_nopush =&gt; true

vim /var/opt/gitlab/nginx/conf/gitlab-http.conf
listen *:8899;
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>å¯ä»¥ä¸ç”¨
cd /usr/local/nginx/conf
# gitlab socket æ–‡ä»¶åœ°å€

upstream gitlab {
Â  # 7.x ç‰ˆæœ¬åœ¨æ­¤ä½ç½®
Â  # server unix:/var/opt/gitlab/gitlab-rails/tmp/sockets/gitlab.socket;
Â  # 8.0 ä½ç½®
Â  server unix://var/opt/gitlab/gitlab-rails/sockets/gitlab.socket;
}

server {
Â  listenÂ  Â  8899;Â  #ä¿®æ”¹ç«¯å£å·ï¼ˆnginxéœ€è¦è®¿é—®çš„ç«¯å£å·å’Œgitlab.rbä¸­ external_urlÂ ç«¯å£å·ä¿æŒä¸€è‡´Â  ï¼‰
Â  server_name localhost;Â Â 
Â  server_tokens off;Â  Â  # don't show the version number, a security best practice
Â  root /opt/gitlab/embedded/service/gitlab-rails/public;
Â  client_max_body_size 250m;
Â  #access_logÂ  /var/log/gitlab/nginx/gitlab_access.log;
Â  #error_logÂ  /var/log/gitlab/nginx/gitlab_error.log;
Â  location / {
Â  Â  try_files $uri $uri/index.html $uri.html @gitlab;
Â  }
Â  location @gitlab {
Â  Â  proxy_read_timeout 300; # Some requests take more than 30 seconds.
Â  Â  proxy_connect_timeout 300; # Some requests take more than 30 seconds.
Â  Â  proxy_redirectÂ  Â  off;
Â  Â  proxy_set_headerÂ  X-Forwarded-Proto $scheme;
Â  Â  proxy_set_headerÂ  HostÂ  Â  Â  Â  Â  Â  Â  $http_host;
Â  Â  proxy_set_headerÂ  X-Real-IPÂ  Â  Â  Â  $remote_addr;
Â  Â  proxy_set_headerÂ  X-Forwarded-ForÂ  $proxy_add_x_forwarded_for;
Â  Â  proxy_set_headerÂ  X-Frame-OptionsÂ  SAMEORIGIN;
Â  Â  proxy_passÂ  Â http://127.0.0.1:8877; #å’Œgitlab.rbä¸­unicorn['port']Â  ç«¯å£å·ä¿æŒä¸€è‡´
Â  }
Â  location ~ ^/(assets)/Â  {
Â  Â  root /opt/gitlab/embedded/service/gitlab-rails/public;
Â  Â  expires max;
Â  Â  add_header Cache-Control public;
Â  }
Â  error_page 502 /502.html;
}
</code></pre></div><ul><li>ç½‘ç»œé—®é¢˜ï¼Œå›½å†…ç”¨æˆ·ï¼Œå»ºè®®ä½¿ç”¨æ¸…åå¤§å­¦çš„é•œåƒæºè¿›è¡Œå®‰è£…</li></ul><div class="language- extra-class"><pre class="language-text"><code>vim /etc/yum.repos.d/gitlab-ce.repo
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>[gitlab-ce]
name=gitlab-ce
baseurl=http://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7
repo_gpgcheck=0
gpgcheck=0
enabled=1
gpgkey=https://packages.gitlab.com/gpg.key
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>yum makecache
yum install gitlab-ce
</code></pre></div><ul><li>å‘½ä»¤ï¼ˆgitlab-ctl reconfigure è¿è¡ŒæŠ¥é”™åŠ  sudoï¼‰</li></ul><div class="language- extra-class"><pre class="language-text"><code>yum list | grep gitlab-ce

/etc/gitlab/gitlab.rb          #gitlabé…ç½®æ–‡ä»¶
/opt/gitlab                    #gitlabçš„ç¨‹åºå®‰è£…ç›®å½•
/var/opt/gitlab                #gitlabç›®å½•æ•°æ®ç›®å½•
/var/opt/gitlab/git-data       #å­˜æ”¾ä»“åº“æ•°æ®
gitlab-ctl reconfigure         #é‡æ–°åŠ è½½é…ç½®
gitlab-ctl status              #æŸ¥çœ‹å½“å‰gitlabæ‰€æœ‰æœåŠ¡è¿è¡ŒçŠ¶æ€
gitlab-ctl stop                #åœæ­¢gitlabæœåŠ¡
gitlab-ctl stop nginx          #å•ç‹¬åœæ­¢æŸä¸ªæœåŠ¡
gitlab-ctl tail                #æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çš„æ—¥å¿—

Gitlabçš„æœåŠ¡æ„æˆï¼š
nginxï¼š                 é™æ€webæœåŠ¡å™¨
gitlab-workhorse        è½»é‡çº§åå‘ä»£ç†æœåŠ¡å™¨
logrotate              æ—¥å¿—æ–‡ä»¶ç®¡ç†å·¥å…·
postgresql             æ•°æ®åº“
redis                  ç¼“å­˜æ•°æ®åº“
sidekiq                ç”¨äºåœ¨åå°æ‰§è¡Œé˜Ÿåˆ—ä»»åŠ¡ï¼ˆå¼‚æ­¥æ‰§è¡Œï¼‰   
</code></pre></div><ul><li>Gitlab æ±‰åŒ–è¡¥ä¸( æ–°ç‰ˆæœ¬è‡ªå¸¦æœ¬åœ°åŒ– )</li></ul><div class="language- extra-class"><pre class="language-text"><code>cat /opt/gitlab/embedded/service/gitlab-rails/VERSION  ==&gt;&gt; 12.1.12     #æŸ¥çœ‹å®‰è£…ç‰ˆæœ¬ï¼Œä¿è¯å®‰è£…ä¸æ±‰åŒ–åŒ…ç‰ˆæœ¬ä¸€è‡´

git clone https://gitlab.com/xhang/gitlab.git
# å…‹éš† GitLab.com ä»“åº“
git clone https://gitlab.com/larryli/gitlab.git
ï¼ƒæˆ– Gitcafe.com é•œåƒï¼Œé€Ÿåº¦æ›´å¿«
git clone https://gitcafe.com/larryli/gitlab.git

cd gitlab
git branch -a
git diff remotes/origin/12-1-stable remotes/origin/12-1-stable-zh &gt; /tmp/12.1.12-zh.diff
gitlab-ctl stop

patch -d /opt/gitlab/embedded/service/gitlab-rails -p1 &lt; /tmp/10.0.0-zh.diff
æˆ–è€… 
# åº”ç”¨æ±‰åŒ–è¡¥ä¸
cd /opt/gitlab/embedded/service/gitlab-rails
git apply /tmp/12.12-zh.diff 


gitlab-ctl start
gitlab-ctl reconfigure
</code></pre></div><h2 id="jenkins">Jenkins</h2><h4 id="é…ç½®ä¿®æ”¹å»ºè®®é‡å¯jenkinsï¼ˆservice-jenkins-restartï¼‰ï¼Œæ„Ÿè§‰ç¼“å­˜ä¸¥é‡">é…ç½®ä¿®æ”¹å»ºè®®é‡å¯Jenkinsï¼ˆservice jenkins restartï¼‰ï¼Œæ„Ÿè§‰ç¼“å­˜ä¸¥é‡</h4><h3 id="å®‰è£…">å®‰è£…</h3><div class="language- extra-class"><pre class="language-text"><code>yum install java
java -version
sudo wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat/jenkins.repo
sudo rpm --import https://pkg.jenkins.io/redhat/jenkins.io.key
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>rpm -ql jenkins                            æŸ¥çœ‹å®‰è£…ç›®å½•
cat /etc/sysconfig/jenkins | more          æŸ¥çœ‹Jenkinsç«¯å£ï¼ˆé»˜è®¤8080ï¼Œé…Œæƒ…ä¿®æ”¹ï¼‰
service start jenkins                      å¯åŠ¨Jenkins
</code></pre></div><h3 id="ç³»ç»Ÿæ’ä»¶é…ç½®">ç³»ç»Ÿæ’ä»¶é…ç½®</h3><h5 id="git-åœ°å€é…ç½®">Git - åœ°å€é…ç½®</h5><div class="language- extra-class"><pre class="language-text"><code>é¦–å…ˆæœåŠ¡å™¨æŸ¥çœ‹ git 
whereis git    --&gt;&gt; git: /usr/local/git /usr/local/git/bin/git /usr/local/git/libexec/git-core/git
é€‰æ‹©å¸¦æœ‰ â€œ/bin/gitâ€ çš„è·¯å¾„  =&gt; /usr/local/git/bin/git
å¦‚æœæ²¡æœ‰ â€œ/bin/gitâ€ åˆ™æ·»åŠ   =&gt; /usr/local/git =&gt; /usr/local/git/bin/git

ç³»ç»Ÿè®¾ç½® - å…¨å±€å·¥å…·é…ç½® - Git
Path to Git executable : /usr/local/git/bin/git
</code></pre></div><h5 id="git-parameter-å‚æ•°æ„å»ºåŒ–">Git Parameter - å‚æ•°æ„å»ºåŒ–</h5><ul><li>å¸¸è§„å‚æ•°é…ç½®</li></ul><div class="language- extra-class"><pre class="language-text"><code>å¸¸è§„å‚æ•°é…ç½® - å‚æ•°åŒ–æ„å»ºè¿‡ç¨‹

Gitå‚æ•°
åç§°  masterBranch ( è¿™ä¸ªåç§°éœ€è¦åœ¨æºç ç®¡ç†Gitå¤„ä½¿ç”¨ $masterBranch )

ğŸŒ°
name ï¼š masterBranch
des  ï¼š åˆ†æ”¯
å‚æ•°ç±»å‹ ï¼š åˆ†æ”¯
é»˜è®¤å€¼ ï¼š origin/master

æºç ç®¡ç† - Git - Branches to build
æŒ‡å®šåˆ†æ”¯ ï¼š$masterBranch
</code></pre></div><h5 id="publish-over-ssh-æœåŠ¡å™¨è‡ªåŠ¨åŒ–">Publish over SSH - æœåŠ¡å™¨è‡ªåŠ¨åŒ–</h5><ul><li>åŸºç¡€ - é…ç½®é¡¹</li></ul><div class="language- extra-class"><pre class="language-text"><code>ç³»ç»Ÿç®¡ç† - ç³»ç»Ÿé…ç½® - Publish over SSH

Passphraseï¼šå¯†ç ï¼ˆkeyçš„å¯†ç ï¼Œæ²¡è®¾ç½®å°±æ˜¯ç©ºï¼‰
Path to keyï¼škeyæ–‡ä»¶ï¼ˆç§é’¥ï¼‰çš„è·¯å¾„
Keyï¼šå°†ç§é’¥å¤åˆ¶åˆ°è¿™ä¸ªæ¡†ä¸­(path to keyå’Œkeyå†™ä¸€ä¸ªå³å¯)

SSH Serversçš„é…ç½®ï¼š
SSH Server Nameï¼šæ ‡è¯†çš„åå­—
Hostnameï¼šéœ€è¦è¿æ¥sshçš„ä¸»æœºåæˆ–ipåœ°å€ï¼ˆå»ºè®®ipï¼‰
Usernameï¼šç”¨æˆ·å
Remote Directoryï¼šè¿œç¨‹ç›®å½•ï¼ˆç”¨äºæ¥æ”¶Jenkinsä¼ è¿‡æ¥çš„ä»£ç ï¼‰

ğŸŒ°ï¼š
Name                   aliyun
Hostname               47.94.86.110
Username               root
Remote Directory       /

é…ç½®æµ‹è¯•
Test Configuration  ==&gt;&gt; Success
</code></pre></div><ul><li>æ„å»ºåæ“ä½œ - é…ç½®é¡¹</li></ul><div class="language- extra-class"><pre class="language-text"><code>æ„å»ºåæ“ä½œ - é…ç½®é¡¹ - Send build artifacts over SSH

Name:é€‰æ‹©ä¸€ä¸ªä½ é…å¥½çš„sshæœåŠ¡å™¨
Source files ï¼šå†™ä½ è¦ä¼ è¾“çš„æ–‡ä»¶è·¯å¾„
Remove prefix ï¼šè¦å»æ‰çš„å‰ç¼€ï¼Œä¸å†™è¿œç¨‹æœåŠ¡å™¨çš„ç›®å½•ç»“æ„å°†å’ŒSource fileså†™çš„ä¸€è‡´
Remote directory ï¼šå†™ä½ è¦éƒ¨ç½²åœ¨è¿œç¨‹æœåŠ¡å™¨çš„é‚£ä¸ªç›®å½•åœ°å€ä¸‹ï¼Œä¸å†™å°±æ˜¯SSH Serversé…ç½®é‡Œé»˜è®¤è¿œç¨‹ç›®å½•
Exec command ï¼šä¼ è¾“å®Œäº†è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œæˆ‘è¿™é‡Œæ‰§è¡Œäº†è§£å‹ç¼©å’Œè§£å‹ç¼©å®Œæˆååˆ é™¤å‹ç¼©åŒ…2ä¸ªå‘½ä»¤

ğŸŒ°ï¼š
SSH Publishers
  SSH Scrver
  	Name ï¼š aliyun
  Transfer Set
  	Source files ï¼š build/build.tar.gz
  	Remove prefix ï¼š build/
  	Remote directory ï¼š /Alex/react-cli/
		Exec command ï¼š  cd /Alex/react-cli
                     tar -zxvf build.tar.gz
                     rm -rf build.tar.gz
</code></pre></div><h5 id="nodejs-node-ç‰ˆæœ¬åˆ‡æ¢ï¼ˆè§£å†³yarn-npm-æ‰¾ä¸åˆ°çš„é—®é¢˜ï¼‰">Nodejs - node ç‰ˆæœ¬åˆ‡æ¢ï¼ˆè§£å†³yarn/npm æ‰¾ä¸åˆ°çš„é—®é¢˜ï¼‰</h5><ul><li>åŸºç¡€ - é…ç½®é¡¹</li></ul><div class="language- extra-class"><pre class="language-text"><code>å®‰è£…
ç³»ç»Ÿç®¡ç† - æ’ä»¶ç®¡ç† - NodeJs

é…ç½®
ç³»ç»Ÿè®¾ç½® - å…¨å±€å·¥å…·é…ç½® - NodeJS  é€‰æ‹©ç‰ˆæœ¬é…ç½®å³å¯
</code></pre></div><ul><li>æ„å»ºç¯å¢ƒ - é…ç½®é¡¹</li></ul><div class="language- extra-class"><pre class="language-text"><code>é€‰ä¸­ Provide Node &amp; npm bin/ folder to PATH
é€‰æ‹© éœ€è¦è¿è¡Œçš„Nodeç¯å¢ƒ
</code></pre></div><h3 id="æ³¨æ„äº‹é¡¹-2">æ³¨æ„äº‹é¡¹</h3><ul><li>git  ls-remote -h ...  ä»€ä¹ˆçš„æŠ¥é”™ï¼ˆåŸå›  Jenkins git ç‰ˆæœ¬å¤ªä½ï¼‰</li></ul><div class="language- extra-class"><pre class="language-text"><code>å¸è½½æœåŠ¡å™¨  git
yum remove -y git

é‡æ–°æºç å®‰è£… git
yum -y install libcurl-devel expat-devel curl-devel  gettext-devel openssl-devel zlib-devel
yum -y install  gcc perl-ExtUtils-MakeMaker
cd /
wget https://mirrors.edge.kernel.org/pub/software/scm/git/git-2.1.1.tar.gz
tar -zvxf git-2.1.1.tar.gz
cd git-2.1.1
make prefix=/usr/local/git all
make prefix=/usr/local/git install

æ·»åŠ ç¯å¢ƒå˜é‡
echo &quot;export PATH=$PATH:/usr/local/git/bin&quot; &gt;&gt; /etc/bashrc
source /etc/bashrc

æŸ¥çœ‹æœ€æ–° git ä¿¡æ¯
git --version  --&gt;&gt; git version 2.1.1
whereis git    --&gt;&gt; git: /usr/local/git /usr/local/git/bin/git /usr/local/git/libexec/git-core/git
</code></pre></div><h2 id="gitlab-jenkins-è‡ªåŠ¨åŒ–éƒ¨ç½²">gitlab + jenkins è‡ªåŠ¨åŒ–éƒ¨ç½²</h2><ul><li><p>æ–°å»ºJenknsé¡¹ç›®</p></li><li><p>å¸¸è§„å‚æ•°é…ç½®</p></li><li><p>æºç ç®¡ç†é…ç½®</p><ul><li>git  - é…ç½®ä»“åº“åœ°å€ ï¼Œ æ·»åŠ å¸å·å‡­è¯åŠæƒé™ï¼ˆpassworld æˆ–è€… sshï¼‰</li></ul></li><li><p>æ„å»ºè§¦å‘å™¨</p><ul><li>Build when a change is pushed to GitLab.  URL: http://47.11.11.11./project/react-cli</li></ul><p>è·å–å½“å‰é¡¹ç›®åœ°å€   http://47.11.11.11./project/react-cli</p><p>ç”Ÿæˆ Secret token(å®‰å…¨ä»¤ç‰Œ)  12425b353j6lk3j6lk47l47l</p><ul><li>geilab é¡¹ç›®é‡Œé¢é…ç½®</li></ul><p>è®¾ç½® - é›†æˆ  ==&gt;&gt; å°†jenkinsé‡Œè·å–çš„    url + Secret token  åˆ†åˆ«é…ç½®åœ¨gitlabä¸­çš„ url Secret Tokenï¼ŒåŠå®Œæˆäº†gitlab Webhooks é…ç½®</p></li><li><p>æ„å»ºç¯å¢ƒ</p><p>é…ç½®node    <code>Provide Node &amp; npm bin/ folder to PATH</code></p></li><li><p>æ„å»º</p></li></ul><div class="language- extra-class"><pre class="language-text"><code>#!/bin/bash
yarn
yarn build
tar -zcvf build.tar.gz *
</code></pre></div></div><div class="page-edit"><!----><!----></div><!----></div></div></div>
    <script src="/Weblog/assets/js/app.bc17a3fe.js" defer></script><script src="/Weblog/assets/js/47.a44c77ff.js" defer></script>
  </body>
</html>
